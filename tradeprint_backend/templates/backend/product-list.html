{% extends "backend/themes/base.html" %}
{% load static %}

{% block content %}
<!-- PAGE WRAPPER -->
<div class="ec-page-wrapper">

	<!-- Header -->
	<header class="ec-main-header" id="header">
		<nav class="navbar navbar-static-top navbar-expand-lg">
			<!-- Sidebar toggle button -->
			<button id="sidebar-toggler" class="sidebar-toggle"></button>
			<!-- search form -->
			<div class="search-form d-lg-inline-block">
				<div class="input-group">
					<input type="text" name="query" id="search-input" class="form-control" placeholder="search.."
						autofocus autocomplete="off" />
					<button type="button" name="search" id="search-btn" class="btn btn-flat">
						<i class="mdi mdi-magnify"></i>
					</button>
				</div>
				<div id="search-results-container">
					<ul id="search-results"></ul>
				</div>
			</div>

			<!-- navbar right -->
			<div class="navbar-right">
				<ul class="nav navbar-nav">
					<!-- User Account -->
					<li class="dropdown user-menu">
						<button class="dropdown-toggle nav-link ec-drop" data-bs-toggle="dropdown"
							aria-expanded="false">
							<img src="{% static 'backend/assets/img/user/user.png' %}" class="user-image"
								alt="User Image" />
						</button>
						<ul class="dropdown-menu dropdown-menu-right ec-dropdown-menu">
							<!-- User image -->
							<li class="dropdown-header">
								<img src="{% static 'backend/assets/img/user/user.png' %}" class="img-circle"
									alt="User Image" />
								<div class="d-inline-block">
									{{ request.user.username }} <small class="pt-1">{{ request.user.email }}</small>
								</div>
							</li>
							<li>
								<a href="user-profile.html">
									<i class="mdi mdi-account"></i> My Profile
								</a>
							</li>

							<li class="dropdown-footer">
								<a href="{% url 'signin' %}"> <i class="mdi mdi-logout"></i> Log Out </a>
							</li>
						</ul>
					</li>

				</ul>
			</div>
		</nav>
	</header>

	<!-- CONTENT WRAPPER -->
	<div class="ec-content-wrapper">
		<div class="content">
			<div class="breadcrumb-wrapper d-flex align-items-center justify-content-between">
				<div>
					<h1>Product List</h1>
					<p class="breadcrumbs"><span><a href="{% url 'admin_dashboard' %}">Home</a></span>
						<span><i class="mdi mdi-chevron-right"></i></span>Products
					</p>
				</div>
				<div>
					<a href="{% url 'product_add' %}" class="btn btn-primary"> Add Product</a>
				</div>
			</div>

			{% if messages %}
			{% for message in messages %}
			<div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
				{{ message }}
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
			</div>
			{% endfor %}
			{% endif %}

			<div class="row">
				<div class="col-12">
					<div class="card card-default">
						<div class="card-header card-header-border-bottom"
							style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1.5rem;">
							<div class="d-flex align-items-center">
								<div class="header-icon me-3"
									style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 10px;">
									<i class="mdi mdi-format-list-bulleted" style="font-size: 28px; color: white;"></i>
								</div>
								<div>
									<h2 style="color: white; margin-bottom: 0.25rem; font-weight: 600;">Product
										Catalog</h2>
									<p class="mb-0" style="color: rgba(255,255,255,0.9); font-size: 0.9rem;">
										Manage all your products in one place</p>
								</div>
							</div>
						</div>

						<div class="card-body">
							<div class="table-responsive">
								<table id="responsive-data-table" class="table table-hover" style="width:100%">
									<thead>
										<tr>
											<th>Image</th>
											<th>Name</th>
											<th>Category</th>
											<th>Base Price</th>
											<th>Stock</th>
											<th>Status</th>
											<th>Created</th>
											<th>Actions</th>
										</tr>
									</thead>

									<tbody>
										{% for product in products %}
										<tr>
											<td>
												{% if product.main_image %}
												<img class="tbl-thumb" src="{{ product.main_image.url }}"
													alt="{{ product.name }}"
													style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;" />
												{% else %}
												<img class="tbl-thumb"
													src="{% static 'backend/assets/img/products/placeholder.jpg' %}"
													alt="No Image"
													style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;" />
												{% endif %}
											</td>
											<td>{{ product.name }}</td>
											<td>
												{% if product.category %}
												{{ product.category.name }}
												{% else %}
												<span class="text-muted">-</span>
												{% endif %}
											</td>
											<td>Â£{{ product.base_price }}</td>
											<td>
												{% if product.stock_quantity > 0 %}
												<span class="badge bg-success">{{ product.stock_quantity }}</span>
												{% else %}
												<span class="badge bg-danger">Out of Stock</span>
												{% endif %}
											</td>
											<td>
												{% if product.status == 'active' %}
												<span class="badge bg-success">Active</span>
												{% elif product.status == 'draft' %}
												<span class="badge bg-warning">Draft</span>
												{% else %}
												<span class="badge bg-secondary">Inactive</span>
												{% endif %}
											</td>
											<td>{{ product.created_at|date:"Y-m-d" }}</td>
											<td>
												<div class="action-buttons">
													<a href="{% url 'product_detail' product.id %}"
														class="btn btn-sm btn-info" title="View Details">
														<i class="mdi mdi-eye"></i>
													</a>
													<a href="{% url 'product_edit' product.id %}"
														class="btn btn-sm btn-primary" title="Edit">
														<i class="mdi mdi-pencil"></i>
													</a>
													<a href="{% url 'product_delete' product.id %}"
														class="btn btn-sm btn-danger"
														onclick="return confirm('Are you sure you want to delete this product?');"
														title="Delete">
														<i class="mdi mdi-delete"></i>
													</a>
												</div>
											</td>
										</tr>
										{% empty %}
										<tr>
											<td colspan="8" class="text-center py-5">
												<div class="text-muted">
													<i class="mdi mdi-package-variant" style="font-size: 48px;"></i>
													<p class="mt-3">No products found. <a
															href="{% url 'product_add' %}">Add your first product</a>
													</p>
												</div>
											</td>
										</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>

							<!-- Pagination -->
							{% if is_paginated %}
							<nav aria-label="Product pagination">
								<ul class="pagination justify-content-center mt-4">
									{% if page_obj.has_previous %}
									<li class="page-item">
										<a class="page-link" href="?page=1" aria-label="First">
											<span aria-hidden="true">&laquo;&laquo;</span>
										</a>
									</li>
									<li class="page-item">
										<a class="page-link" href="?page={{ page_obj.previous_page_number }}"
											aria-label="Previous">
											<span aria-hidden="true">&laquo;</span>
										</a>
									</li>
									{% endif %}

									{% for num in page_obj.paginator.page_range %}
									{% if page_obj.number == num %}
									<li class="page-item active"><span class="page-link">{{ num }}</span></li>
									{% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %} <li
										class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
										{% endif %}
										{% endfor %}

										{% if page_obj.has_next %}
										<li class="page-item">
											<a class="page-link" href="?page={{ page_obj.next_page_number }}"
												aria-label="Next">
												<span aria-hidden="true">&raquo;</span>
											</a>
										</li>
										<li class="page-item">
											<a class="page-link" href="?page={{ page_obj.paginator.num_pages }}"
												aria-label="Last">
												<span aria-hidden="true">&raquo;&raquo;</span>
											</a>
										</li>
										{% endif %}
								</ul>
							</nav>
							{% endif %}
						</div>
					</div>
				</div>
			</div>
		</div> <!-- End Content -->
	</div> <!-- End Content Wrapper -->

	<!-- End Page Wrapper -->

	<style>
		.table-hover tbody tr:hover {
			background-color: rgba(102, 126, 234, 0.05);
		}

		.tbl-thumb {
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		}

		.action-buttons {
			display: flex;
			gap: 0.5rem;
			justify-content: center;
		}

		.action-buttons .btn {
			padding: 0.375rem 0.75rem;
			transition: all 0.3s ease;
			border: none;
		}

		.action-buttons .btn-info {
			background-color: #17a2b8;
			color: white;
		}

		.action-buttons .btn-info:hover {
			background-color: #138496;
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(23, 162, 184, 0.3);
		}

		.action-buttons .btn-primary {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
		}

		.action-buttons .btn-primary:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
		}

		.action-buttons .btn-danger {
			background-color: #dc3545;
			color: white;
		}

		.action-buttons .btn-danger:hover {
			background-color: #c82333;
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
		}

		.badge {
			padding: 0.35em 0.65em;
			font-weight: 500;
		}

		.card-header h2 {
			font-size: 1.5rem;
		}

		thead th {
			background-color: #f8f9fa;
			font-weight: 600;
			text-transform: uppercase;
			font-size: 0.75rem;
			letter-spacing: 0.5px;
			color: #495057;
			border-bottom: 2px solid #dee2e6;
		}

		.pagination .page-link {
			color: #667eea;
			border-color: #dee2e6;
		}

		.pagination .page-item.active .page-link {
			background-color: #667eea;
			border-color: #667eea;
		}

		.pagination .page-link:hover {
			background-color: rgba(102, 126, 234, 0.1);
			border-color: #667eea;
		}
	</style>

	<!-- DataTables JS -->
	<script src="{% static 'backend/assets/plugins/data-tables/jquery.datatables.min.js' %}"></script>
	<script src="{% static 'backend/assets/plugins/data-tables/datatables.bootstrap5.min.js' %}"></script>

	<script>
		$(document).ready(function () {
			$('#responsive-data-table').DataTable({
				"order": [[6, "desc"]], // Sort by created date descending
				"pageLength": 25,
				"language": {
					"search": "Search products:",
					"lengthMenu": "Show _MENU_ products per page",
					"info": "Showing _START_ to _END_ of _TOTAL_ products",
					"infoEmpty": "No products available",
					"infoFiltered": "(filtered from _MAX_ total products)"
				}
			});
		});
	</script>

	{% endblock content %}